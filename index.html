<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Transparence – Informations du lot</title>
<style>
/* --- RESET ET BODY --- */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #F7F3ED;
    color: #0f1724;
    padding: 0;
}

/* Loader */
#loader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    display: none;
}
#loader img {
    width: 150px;
    animation: spin 1.5s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Bannière */
.header-images img { width: 100%; height: auto; display: block; }

/* --- TITRE --- */
h1 { text-align: center; margin: 20px 0; }

/* --- CHAMP DE LOT --- */
#lotInput, button { font-size: 16px; padding: 6px 10px; }

/* --- ACCORDIONS --- */
.accordion {
    background: #f0e6d2;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    margin: 20px auto;
    max-width: 900px;
}

.accordion-header {
    background-size: cover;
    background-position: center;
    height: 100px;
    position: relative;
    cursor: pointer;
}

.accordion-title {
    position: absolute;
    bottom: 10px;
    left: 20px;
    font-size: 26px;
    color: white;
    font-weight: bold;
    z-index: 5;
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
    background: #fff;
    padding: 0 20px;
}

/* --- RÉGLETTE CARBONE --- */
.carbon-rule {
    height: 48px;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    align-items: center;
    margin-top: 12px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}

.seg {
    height: 100%;
    display: inline-block;
    transition: width 0.3s ease;
}

.seg.agri { background: #15803d; }
.seg.transp { background: #d9f99d; }
.seg.malt { background: #fde68a; }

.numbers {
    display: flex;
    gap: 16px;
    margin-top: 16px;
    flex-wrap: wrap;
}

.stat {
    padding: 14px;
    border-radius: 12px;
    border: 1px solid transparent;
    min-width: 140px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    font-size: 14px;
}

.stat.agri { background: #15803d; color: #fff; border-color: #064e3b; }
.stat.transp { background: #d9f99d; border-color: #15803d; }
.stat.malt { background: #fde68a; border-color: #b45309; }
.stat.total { background: #fff; border-color: #e2e8f0; color: #0f1724; }
.stat strong { display: block; font-size: 20px; margin-top: 4px; }


.accordion-content.open { padding: 20px; }

ul { margin: 10px 0 20px 20px; padding: 0; list-style-type: disc; }
ul li { margin-bottom: 6px; }

/* --- FOOTER --- */
footer {
    background: #e2e2e2;
    padding: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

footer .footer-block {
    display: flex;
    align-items: center;
    margin: 10px;
}

footer .footer-block img {
    max-width: 80px;
    margin-right: 15px;
}

footer .footer-text {
    font-size: 14px;
    line-height: 1.4;
}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader" aria-hidden="true" style="display: none;">
    <!-- Remplacez le src par le chemin correct vers votre image -->
    <img src="Dessin_chope_de_biere_480x480-removebg-preview.png" alt="Chargement...">
</div>

<!-- BANNIERE -->
<div class="header-images">
    <img src="bannire-fine.png" alt="Bannière The Malt Initiative">
</div>

<h1>Informations du Lot</h1>

<!-- CHAMP DE SAISIE DU LOT -->
<div style="text-align:center; margin:20px;">
    <label for="lotInput"><strong>Entrer le numéro de lot :</strong></label>
    <input type="text" id="lotInput" placeholder="Ex : MO-1" style="padding:6px 10px; border-radius:6px; border:1px solid #ccc;">
    <button id="loadBtn" style="padding: 6px 12px; border-radius: 6px; border: none; background: rgb(21, 128, 61); color: white;">Charger le lot</button>
</div>

<!-- ACCORDÉON EMPREINTE CARBONE -->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)"
         style="background-image:url('vue-des-arbres-de-la-foret-verte-avec-co2 (2).jpg');">
        <div class="accordion-title">Empreinte carbone du lot</div>
    </div>
    <div class="accordion-content">
        <h3>Émissions (kg CO₂e)</h3>
        <ul>
            <li id="liAgriculture">Agriculture : <span id="Agriculture">—</span></li>
            <li id="liCooperative">Coopérative : <span id="Coopérative">—</span></li>
            <li id="liTransport">Transport : <span id="Transport">—</span></li>
            <li id="liMalterie">Malterie : <span id="Malterie">—</span></li>
            <li id="liTotal"><strong>Total : <span id="Total">—</span></strong></li>
        </ul>

        <!-- RÉGLETTE CARBONE -->
        <div class="carbon-rule">
            <div id="segAgriculture" class="seg agri" style="width:0%"></div>
            <div id="segTransport" class="seg transp" style="width:0%"></div>
            <div id="segMalterie" class="seg malt" style="width:0%"></div>
        </div>
    </div>
</div>



    
<!-- ACCORDÉONS Agriculture-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;barley.jpg&#39;);">
        <div class="accordion-title">Récolte des céréales</div>
    </div>
    <div class="accordion-content" style="">
        <ul>
            
            <li>Nom de l'exploitation agricole : <span id="nomExploitation">—</span></li>
            <li>Téléphone : <span id="telephone">—</span></li>
            <li>Commune : <span id="commune">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>N° SIRET : <span id="siret">—</span></li>
            <li>Date de validité certification bio : <span id="dateCertificationBio">—</span></li>
            <li>Identifiant de la parcelle (n° PAC) : <span id="numeroParcellePAC">—</span></li>
            <li>Surface de la parcelle (ha) : <span id="surfaceParcelle">—</span></li>
            <li>Coordonnées GPS de la parcelle (Latitude) : <span id="gpsLatitude">—</span></li>
            <li>Coordonnées GPS de la parcelle (Longitude) : <span id="gpsLongitude">—</span></li>
            <li>Type de céréale cultivée : <span id="typeCerealeCultivee">—</span></li>
            <li>Variété de céréale : <span id="varieteCereale">—</span></li>
            <li>Y a-t-il eu un travail du sol ? : <span id="travailSol">—</span></li>
            <li>Et un désherbage mécanique ? : <span id="desherbageMecanique">—</span></li>
            <li>Si oui, combien de passages ? : <span id="nombrePassages">—</span></li>
            <li>Y a-t-il une présence de fertilisation organique ? : <span id="fertilisationOrganique">—</span></li>
            <li>Type de fertilisation : <span id="typeFertilisation">—</span></li>
            <li>Quantité (t/ha) : <span id="quantiteFertilisation">—</span></li>
            <li>Utilisation de l'irrigation : <span id="utilisationIrrigation">—</span></li>
            <li>Quantité : <span id="quantiteIrrigation">—</span></li>
            <li>Événements particuliers ayant eu lieu : <span id="evenementsParticuliers">—</span></li>
            <li>Date de la récolte : <span id="dateRecolte">—</span></li>
            <li>Tonnage récolté : <span id="tonnageRecolte">—</span></li>
            <li>Stockage à la ferme : <span id="stockageFerme">—</span></li>
            <li>Date de livraison à la Malterie Occitane : <span id="dateLivraisonMalterie">—</span></li>
            <li>Poids net livré (Malterie) : <span id="poidsNetLivreMalterie">—</span></li>
            <li>Distance du site de stockage à la Malterie (en km) : <span id="distanceStockageMalterie">—</span></li>
            <li>Livraison à une coopérative : <span id="livraisonCooperative">—</span></li>
            <li>Date de livraison à la coopérative : <span id="dateLivraisonCoop">—</span></li>
            <li>Poids net livré (Coopérative) : <span id="poidsNetLivreCoop">—</span></li>
            <li>Humidité de la récolte (en %) : <span id="humiditeRecolte">—</span></li>
            <li>Taux de protéines à la récolte (en %) : <span id="proteinesRecolte">—</span></li>
            <li>Teneur en impuretés (en %) : <span id="impuretesRecolte">—</span></li>

        </ul>
    </div>
</div>
<!-- ACCORDÉONS Malterie-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;malt-4950433_1280.jpg&#39;);">
        <div class="accordion-title">Maltage (Malterie Occitane)</div>
    </div>
    <div class="accordion-content">
        <h3>Étapes du procédé</h3>
        <ul>
            <li>ID de la réponse : <span id="idReponse">—</span></li>
            <li>N° du lot de céréales : <span id="numeroLot">—</span></li>
            <li>Date de réception du lot : <span id="dateReceptionLot">—</span></li>
            <li>Type de céréale : <span id="typeCereale">—</span></li>
            <li>Variété : <span id="variete">—</span></li>
            <li>Bio ou conventionnel : <span id="bioConventionnel">—</span></li>
            <li>Masse du lot (en t) : <span id="masseLotT">—</span></li>
            <li>Triage, calibrage, nettoyage : <span id="triageCalibrage">—</span></li>
            <li>Date de production : <span id="dateProduction">—</span></li>
            <li>Nommer le fournisseur : <span id="fournisseur">—</span></li>
            <li>Silo (ou lieu) d'origine : <span id="siloOrigine">—</span></li>
            <li>Nom : <span id="nom">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>Distance à la Malterie (en km) : <span id="distanceMalterie">—</span></li>
            <li>Nombre de trempes : <span id="nombreTrempes">—</span></li>
            <li>Temps de trempage : <span id="tempsTrempage">—</span></li>
            <li>Volume d'eau total utilisé : <span id="volumeEau">—</span></li>
            <li>Masse du lot : <span id="masseLot">—</span></li>
            <li>Masse de grains germés : <span id="masseGrainsGermes">—</span></li>
            <li>Hauteur de la couche (en cm) : <span id="hauteurCouche">—</span></li>
            <li>Température du lit (en °C) : <span id="temperatureLit">—</span></li>
            <li>Temps de germination (en heures) : <span id="tempsGermination">—</span></li>
            <li>Temps du touraillage (en heures) : <span id="tempsTouraillage">—</span></li>
            <li>Nombre de paliers : <span id="nombrePaliers">—</span></li>
            <li>Température moyenne de séchage (en °C) : <span id="temperatureSechage">—</span></li>
            
            <li>Brasserie 1 : <span id="brasserie1">—</span></li>
            <li>Brasserie 2 : <span id="brasserie2">—</span></li>
            <li>Brasserie 3 : <span id="brasserie3">—</span></li>
            <li>Brasserie 4 : <span id="brasserie4">—</span></li>
            <li>Brasserie 5 : <span id="brasserie5">—</span></li>
            <li>Brasserie 6 : <span id="brasserie6">—</span></li>
            <li>Brasserie 7 : <span id="brasserie7">—</span></li>
            <li>Brasserie 8 : <span id="brasserie8">—</span></li>
            <li>Brasserie 9 : <span id="brasserie9">—</span></li>
            <li>Brasserie 10 : <span id="brasserie10">—</span></li>
           
            
            <li>Taux d'humidité au début (%) : <span id="humiditeDebut">—</span></li>
            <li>Taux d'humidité à la fin (%) : <span id="humiditeFin">—</span></li>
            <li>Taux de protéines au début (%) : <span id="proteinesDebut">—</span></li>
            <li>Taux de protéines à la fin (%) : <span id="proteinesFin">—</span></li>
            <li>Extrait brut au début (%) : <span id="extraitDebut">—</span></li>
            <li>Extrait brut à la fin (%) : <span id="extraitFin">—</span></li>
            <li>Teneur en Beta-Glucanes au début : <span id="betaGlucanesDebut">—</span></li>
            <li>Teneur en Beta-Glucanes à la fin : <span id="betaGlucanesFin">—</span></li>
            <li>Teneur en impuretés au début : <span id="impuretesDebut">—</span></li>
            <li>Teneur en impuretés à la fin : <span id="impuretesFin">—</span></li>

        </ul>
    </div>
</div>



<!-- ACCORDÉONS Brasserie-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;beer-2370783_1280.jpg&#39;);">
        <div class="accordion-title">Brassage</div>
    </div>
    <div class="accordion-content">
        <ul>
            <li>Identification du lot : <span id="identificationLot">—</span></li>
            <li>Nom de la distillerie : <span id="nomDistillerie">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>Type d'alambic : <span id="typeAlambic">—</span></li>
            <li>Date du brassage : <span id="dateBrassage">—</span></li>
            <li>Date de la distillation : <span id="dateDistillation">—</span></li>
            <li>Volume du wash (fini) : <span id="volumeWash">—</span></li>
            <li>Volume du distillat : <span id="volumeDistillat">—</span></li>
            <li>Vol alcool pur (LAP) : <span id="volumeAlcoolPur">—</span></li>
            
            <li>Type de malt : <span id="typeMalt">—</span></li>
            <li>Quantité de malt (kg) : <span id="quantiteMalt">—</span></li>
            <li>Ratio du malt : <span id="ratioMalt">—</span></li>
            <li>Origine / Fournisseur du malt : <span id="origineMalt">—</span></li>
            <li>N° de lot du malt : <span id="lotMalt">—</span></li>
            
            <li>Souche / type de levure : <span id="typeLevure">—</span></li>
            <li>Origine de la levure : <span id="origineLevure">—</span></li>
            <li>Fournisseur de la levure : <span id="fournisseurLevure">—</span></li>
            
            <li>Correction apportée à l'eau : <span id="correctionEau">—</span></li>
            <li>pH corrigé au départ : <span id="phDepart">—</span></li>
            <li>pH corrigé en fin de brassage : <span id="phFin">—</span></li>
            <li>Dureté : <span id="dureteEau">—</span></li>
            <li>Additifs / Ingrédients spéciaux : <span id="additifsSpeciaux">—</span></li>
            
            <li>Consommation d'eau pour ce brassin : <span id="consoEauBrassin">—</span></li>
            <li>Consommation d'eau pour le nettoyage : <span id="consoEauNettoyage">—</span></li>
            <li>Consommation d'énergie estimée : <span id="consoEnergie">—</span></li>
            
            <li>Valorisation des drêches : <span id="valorisationDreches">—</span></li>
            <li>Comment (drêches) ? : <span id="commentDreches">—</span></li>
            <li>Gestion des déchets / recyclage : <span id="gestionDechets">—</span></li>
            <li>Comment (déchets) ? : <span id="commentDechets">—</span></li>
            
            <li>Mode de conditionnement du produit fini : <span id="modeConditionnement">—</span></li>

        </ul>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-infos">
        <div class="footer-block">
            <img src="Capture_d_écran_2025-11-17_220106-removebg-preview.png" alt="">
            <div class="footer-text">
                <strong>Malterie Occitane</strong><br>
                malterieoccitane.fr<br>
                1273 Avenue des Terres Noires, 81370 St Sulpice la Pointe
            </div>
        </div>
        <div class="footer-block">
            <img src="content.png" alt="">
            <div class="footer-text">
                <strong>The Malt Initiative – Projet Grain Trust :</strong><br>
                Projet Ingénieur Agronome de l’AgroToulouse<br>
                Mail : themaltinitiative@gmail.com
            </div>
        </div>
    </div>
</footer>

<script>
<script>
// --- ACCORDIONS ---
function toggleAccordion(header){
    const content = header.nextElementSibling;
    const isOpen = content.style.maxHeight;

    document.querySelectorAll('.accordion-content').forEach(c => {
        c.style.maxHeight = null;
        c.classList.remove("open");
    });

    if(!isOpen){
        content.style.maxHeight = content.scrollHeight + "px";
        content.classList.add("open");
    }
}

// Parser CSV avec en-tête
function parseCSV(csv) {
    const lines = csv.trim().split(/\r?\n/);
    if(lines.length < 2) return [];

    const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));

    return lines.slice(1).map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"') inQuotes = !inQuotes;
            else if (char === ',' && !inQuotes) {
                values.push(current.trim().replace(/^"|"$/g, ''));
                current = '';
            } else current += char;
        }
        values.push(current.trim().replace(/^"|"$/g, ''));

        const obj = {};
        headers.forEach((h,i) => obj[h] = values[i] || '');
        return obj;
    });
}

// Masquer automatiquement les champs vides
function masquerChampsVides() {
    document.querySelectorAll("li").forEach(li => {
        const span = li.querySelector("span");
        if (!span) return;
        const valeur = span.textContent.trim();
        if (valeur === "" || valeur === "—" || valeur === "-" || valeur.toLowerCase() === "null") {
            li.style.display = "none";
        } else {
            li.style.display = "list-item";
        }
    });
}

// Fonction sécurisée pour mettre à jour un span
function setTextSafe(id, value) {
    const el = document.getElementById(id);
    if(el) el.textContent = value || '—';
}

// Mettre à jour la réglette carbone
function updateCarbon(line) {
    const map = {
        "Agriculture :": "Agriculture",
        "Coopérative :": "Coopérative",
        "Transport :": "Transport",
        "Malterie :": "Malterie",
        "Total :": "Total"
    };

    let total = 0;
    const values = {};

    for (const [csvKey, id] of Object.entries(map)) {
        const value = parseFloat((line[csvKey] || '0').replace(',', '.')) || 0;
        values[id] = value;
        total += value;

        const span = document.getElementById(id);
        const li = document.getElementById('li' + id);
        if(span && li){
            if(value === 0){
                li.style.display = "none";
            } else {
                span.textContent = value;
                li.style.display = "list-item";
            }
        }
    }

    // Mise à jour des segments de la réglette
    const segAgriculture = document.getElementById('segAgriculture');
    const segTransport = document.getElementById('segTransport');
    const segMalterie = document.getElementById('segMalterie');

    if(total > 0){
        if(segAgriculture) segAgriculture.style.width = (values["Agriculture"]/total*100) + '%';
        if(segTransport) segTransport.style.width = (values["Transport"]/total*100) + '%';
        if(segMalterie) segMalterie.style.width = (values["Malterie"]/total*100) + '%';
    } else {
        if(segAgriculture) segAgriculture.style.width = '0';
        if(segTransport) segTransport.style.width = '0';
        if(segMalterie) segMalterie.style.width = '0';
    }
}

// Mettre à jour la page avec la ligne sélectionnée
function updatePageWithLine(line){
    if(!line) return;

    // Mapping CSV -> ID
    const fields = {
        // Agriculture / Exploitant
        "Nom de l'exploitation agricole :": "nomExploitation",
        "Téléphone :": "telephone",
        "Commune :": "commune",
        "Code Postal :": "codePostal",
        "N°SIRET :": "siret",
        "Date de validité certification bio": "dateCertificationBio",
        "Identifiant de la parcelle (n°PAC) :": "numeroParcellePAC",
        "Surface de la parcelle (ha) :": "surfaceParcelle",
        "Coordonnées GPS de la parcelle (Latitude) :": "gpsLatitude",
        "Coordonnées GPS de la parcelle (Longitude) :": "gpsLongitude",
        "Type de céréale cultivée :": "typeCerealeCultivee",
        "Variété de céréale :": "varieteCereale",
        "Y a-t-il eu un travail du sol ?": "travailSol",
        "Et un désherbage mécanique ?": "desherbageMecanique",
        "Si oui combien de passages ?": "nombrePassages",
        "Y a-t-il une présence de fertilisation organique ?": "fertilisationOrganique",
        "Type de fertilisation :": "typeFertilisation",
        "Quantité (t/ha) :": "quantiteFertilisation",
        "Utilisation de l'irrigation :": "utilisationIrrigation",
        "Quantité :": "quantiteIrrigation",
        "Événements particuliers ayant eu lieu :": "evenementsParticuliers",
        "Date de la récolte :": "dateRecolte",
        "Tonnage récolté :": "tonnageRecolte",
        "Stockage à la ferme :": "stockageFerme",
        "Date de livraison à la Malterie Occitane :": "dateLivraisonMalterie",
        "Poids net livré (Malterie) :": "poidsNetLivreMalterie",
        "Distance du site de stockage à la Malterie (en km) :": "distanceStockageMalterie",
        "Livraison à une coopérative :": "livraisonCooperative",
        "Date de livraison à la coopérative :": "dateLivraisonCoop",
        "Poids net livré (Coopérative) :": "poidsNetLivreCoop",
        "Humidité de la récolte (en %) :": "humiditeRecolte",
        "Taux de protéines à la récolte (en %) :": "proteinesRecolte",
        "Teneur en impuretés (en %) :": "impuretesRecolte",

        // Malterie
        "ID de la réponse": "idReponse",
        "N° du lot de céréales :": "numeroLot",
        "Date de réception du lot :": "dateReceptionLot",
        "Type de céréale :": "typeCereale",
        "Variété :": "variete",
        "Bio ou conventionnel :": "bioConventionnel",
        "Masse du lot (en t) :": "masseLotT",
        "Triage, calibrage, nettoyage :": "triageCalibrage",
        "Date de production :": "dateProduction",
        "Nommer le fournisseur :": "fournisseur",
        "Silo (ou lieu) d'origine :": "siloOrigine",
        "Nom :": "nom",
        "Distance à la Malterie (en km) :": "distanceMalterie",
        "Nombre de trempes :": "nombreTrempes",
        "Temps de trempage :": "tempsTrempage",
        "Volume d'eau total utilisé :": "volumeEau",
        "Masse du lot :": "masseLot",
        "Masse de grains germés :": "masseGrainsGermes",
        "Hauteur de la couche (en cm) :": "hauteurCouche",
        "Température du lit (en °C) :": "temperatureLit",
        "Temps de germination (en heures) :": "tempsGermination",
        "Temps du touraillage (en heures) :": "tempsTouraillage",
        "Nombre de paliers :": "nombrePaliers",
        "Température moyenne de séchage (en °C) :": "temperatureSechage",
        // ... tu peux continuer de la même manière pour les autres sections (brasserie, etc.)
    };

    // Boucle sur les champs
    for(const [csvKey, id] of Object.entries(fields)){
        setTextSafe(id, line[csvKey]);
    }

    // Mettre à jour l'empreinte carbone
    updateCarbon(line);

    // Masquer automatiquement les champs vides
    masquerChampsVides();
}

// --- CHARGEMENT DU LOT ---
async function loadLot() {
    const loadBtn = document.getElementById('loadBtn');
    const lotInput = document.getElementById('lotInput').value.trim();
    if (!lotInput) { alert("Veuillez entrer un numéro de lot !"); return; }

    const isAdult = confirm("Ce site présente des informations liées à l'alcool.\nConfirmez-vous avoir plus de 18 ans ?");
    if (!isAdult) { alert("Accès refusé : vous devez être majeur."); return; }

    const parts = lotInput.split('-');
    if(parts.length !== 2){ alert("Format invalide : MO-1"); return; }

    const csvFile = parts[0];
    const idRecherche = parts[1];

    const loader = document.getElementById('loader');
    loader.style.display = "flex";
    loadBtn.disabled = true;
    loadBtn.style.opacity = 0.6;
    loadBtn.style.cursor = 'not-allowed';

    await new Promise(r => setTimeout(r, 500));

    const csvPath = `https://raw.githubusercontent.com/themaltinitiative-ops/Malt-Initiative/master/data/${csvFile}.csv`;

    try {
        const response = await fetch(csvPath);
        if(!response.ok) throw new Error("Fichier CSV introuvable");

        const csvText = await response.text();
        const data = parseCSV(csvText);

        const line = data.find(d => (d["ID de la réponse"] || '').trim() === idRecherche.trim());
        if(!line) throw new Error("ID non trouvé dans le CSV");

        updatePageWithLine(line);

    } catch(err){
        alert("Erreur : " + err.message);
    } finally {
        loader.style.display = "none";
        loadBtn.disabled = false;
        loadBtn.style.opacity = '';
        loadBtn.style.cursor = '';
    }
}

document.getElementById('loadBtn').addEventListener('click', loadLot);
</script>


