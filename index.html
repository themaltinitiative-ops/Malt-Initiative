<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Transparence – Informations du lot</title>
<style>
/* --- RESET ET BODY --- */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #F7F3ED;
    color: #0f1724;
    padding: 0;
}

/* Loader */
#loader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    display: none;
}
#loader img {
    width: 150px;
    animation: spin 1.5s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Bannière */
.header-images img { width: 100%; height: auto; display: block; }

/* --- TITRE --- */
h1 { text-align: center; margin: 20px 0; }

/* --- CHAMP DE LOT --- */
#lotInput, button { font-size: 16px; padding: 6px 10px; }

/* --- ACCORDIONS --- */
.accordion {
    background: #f0e6d2;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    margin: 20px auto;
    max-width: 900px;
}

.accordion-header {
    background-size: cover;
    background-position: center;
    height: 100px;
    position: relative;
    cursor: pointer;
}

.accordion-title {
    position: absolute;
    bottom: 10px;
    left: 20px;
    font-size: 26px;
    color: white;
    font-weight: bold;
    z-index: 5;
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
    background: #fff;
    padding: 0 20px;
}

.accordion-content.open { padding: 20px; }

ul { margin: 10px 0 20px 20px; padding: 0; list-style-type: disc; }
ul li { margin-bottom: 6px; }

/* --- FOOTER --- */
footer {
    background: #e2e2e2;
    padding: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

footer .footer-block {
    display: flex;
    align-items: center;
    margin: 10px;
}

footer .footer-block img {
    max-width: 80px;
    margin-right: 15px;
}

footer .footer-text {
    font-size: 14px;
    line-height: 1.4;
}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader" aria-hidden="true" style="display: none;">
    <!-- Remplacez le src par le chemin correct vers votre image -->
    <img src="Dessin_chope_de_biere_480x480-removebg-preview.png" alt="Chargement...">
</div>

<!-- BANNIERE -->
<div class="header-images">
    <img src="bannire-fine.png" alt="Bannière The Malt Initiative">
</div>

<h1>Informations du Lot</h1>

<!-- CHAMP DE SAISIE DU LOT -->
<div style="text-align:center; margin:20px;">
    <label for="lotInput"><strong>Entrer le numéro de lot :</strong></label>
    <input type="text" id="lotInput" placeholder="Ex : MO-1" style="padding:6px 10px; border-radius:6px; border:1px solid #ccc;">
    <button id="loadBtn" style="padding: 6px 12px; border-radius: 6px; border: none; background: rgb(21, 128, 61); color: white;">Charger le lot</button>
</div>

<!-- ACCORDÉON EMPREINTE CARBONE -->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)"
         style="background-image:url('vue-des-arbres-de-la-foret-verte-avec-co2 (2).jpg');">
        <div class="accordion-title">Empreinte carbone du lot</div>
    </div>
    <div class="accordion-content">
        <h3>Émissions (kg CO₂e)</h3>
        <ul>
            <li>Agriculture : <span id="Agriculture">—</span></li>
            <li>Coopérative : <span id="Coopérative">—</span></li>
            <li>Transport : <span id="Transport">—</span></li>
            <li>Malterie : <span id="Malterie">—</span></li>
            <li><strong>Total : <span id="Total">—</span></strong></li>
        </ul>
    </div>
</div>


    
<!-- ACCORDÉONS Agriculture-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;barley.jpg&#39;);">
        <div class="accordion-title">Récolte des céréales</div>
    </div>
    <div class="accordion-content" style="">
        <h3>Agriculteur</h3>
        <ul>
            
            <li>Nom de l'exploitation agricole : <span id="nomExploitation">—</span></li>
            <li>Téléphone : <span id="telephone">—</span></li>
            <li>Commune : <span id="commune">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>N° SIRET : <span id="siret">—</span></li>
            <li>Date de validité certification bio : <span id="dateCertificationBio">—</span></li>
            <li>Identifiant de la parcelle (n° PAC) : <span id="numeroParcellePAC">—</span></li>
            <li>Surface de la parcelle (ha) : <span id="surfaceParcelle">—</span></li>
            <li>Coordonnées GPS de la parcelle (Latitude) : <span id="gpsLatitude">—</span></li>
            <li>Coordonnées GPS de la parcelle (Longitude) : <span id="gpsLongitude">—</span></li>
            <li>Type de céréale cultivée : <span id="typeCerealeCultivee">—</span></li>
            <li>Variété de céréale : <span id="varieteCereale">—</span></li>
            <li>Y a-t-il eu un travail du sol ? : <span id="travailSol">—</span></li>
            <li>Et un désherbage mécanique ? : <span id="desherbageMecanique">—</span></li>
            <li>Si oui, combien de passages ? : <span id="nombrePassages">—</span></li>
            <li>Y a-t-il une présence de fertilisation organique ? : <span id="fertilisationOrganique">—</span></li>
            <li>Type de fertilisation : <span id="typeFertilisation">—</span></li>
            <li>Quantité (t/ha) : <span id="quantiteFertilisation">—</span></li>
            <li>Utilisation de l'irrigation : <span id="utilisationIrrigation">—</span></li>
            <li>Quantité : <span id="quantiteIrrigation">—</span></li>
            <li>Événements particuliers ayant eu lieu : <span id="evenementsParticuliers">—</span></li>
            <li>Date de la récolte : <span id="dateRecolte">—</span></li>
            <li>Tonnage récolté : <span id="tonnageRecolte">—</span></li>
            <li>Stockage à la ferme : <span id="stockageFerme">—</span></li>
            <li>Date de livraison à la Malterie Occitane : <span id="dateLivraisonMalterie">—</span></li>
            <li>Poids net livré (Malterie) : <span id="poidsNetLivreMalterie">—</span></li>
            <li>Distance du site de stockage à la Malterie (en km) : <span id="distanceStockageMalterie">—</span></li>
            <li>Livraison à une coopérative : <span id="livraisonCooperative">—</span></li>
            <li>Date de livraison à la coopérative : <span id="dateLivraisonCoop">—</span></li>
            <li>Poids net livré (Coopérative) : <span id="poidsNetLivreCoop">—</span></li>
            <li>Humidité de la récolte (en %) : <span id="humiditeRecolte">—</span></li>
            <li>Taux de protéines à la récolte (en %) : <span id="proteinesRecolte">—</span></li>
            <li>Teneur en impuretés (en %) : <span id="impuretesRecolte">—</span></li>

        </ul>
    </div>
</div>
<!-- ACCORDÉONS Malterie-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;malt-4950433_1280.jpg&#39;);">
        <div class="accordion-title">Maltage (Malterie Occitane)</div>
    </div>
    <div class="accordion-content">
        <h3>Étapes du procédé</h3>
        <ul>
            <li>ID de la réponse : <span id="idReponse">—</span></li>
            <li>N° du lot de céréales : <span id="numeroLot">—</span></li>
            <li>Date de réception du lot : <span id="dateReceptionLot">—</span></li>
            <li>Type de céréale : <span id="typeCereale">—</span></li>
            <li>Variété : <span id="variete">—</span></li>
            <li>Bio ou conventionnel : <span id="bioConventionnel">—</span></li>
            <li>Masse du lot (en t) : <span id="masseLotT">—</span></li>
            <li>Triage, calibrage, nettoyage : <span id="triageCalibrage">—</span></li>
            <li>Date de production : <span id="dateProduction">—</span></li>
            <li>Nommer le fournisseur : <span id="fournisseur">—</span></li>
            <li>Silo (ou lieu) d'origine : <span id="siloOrigine">—</span></li>
            <li>Nom : <span id="nom">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>Distance à la Malterie (en km) : <span id="distanceMalterie">—</span></li>
            <li>Nombre de trempes : <span id="nombreTrempes">—</span></li>
            <li>Temps de trempage : <span id="tempsTrempage">—</span></li>
            <li>Volume d'eau total utilisé : <span id="volumeEau">—</span></li>
            <li>Masse du lot : <span id="masseLot">—</span></li>
            <li>Masse de grains germés : <span id="masseGrainsGermes">—</span></li>
            <li>Hauteur de la couche (en cm) : <span id="hauteurCouche">—</span></li>
            <li>Température du lit (en °C) : <span id="temperatureLit">—</span></li>
            <li>Temps de germination (en heures) : <span id="tempsGermination">—</span></li>
            <li>Temps du touraillage (en heures) : <span id="tempsTouraillage">—</span></li>
            <li>Nombre de paliers : <span id="nombrePaliers">—</span></li>
            <li>Température moyenne de séchage (en °C) : <span id="temperatureSechage">—</span></li>
            
            <li>Brasserie 1 : <span id="brasserie1">—</span></li>
            <li>Brasserie 2 : <span id="brasserie2">—</span></li>
            <li>Brasserie 3 : <span id="brasserie3">—</span></li>
            <li>Brasserie 4 : <span id="brasserie4">—</span></li>
            <li>Brasserie 5 : <span id="brasserie5">—</span></li>
            <li>Brasserie 6 : <span id="brasserie6">—</span></li>
            <li>Brasserie 7 : <span id="brasserie7">—</span></li>
            <li>Brasserie 8 : <span id="brasserie8">—</span></li>
            <li>Brasserie 9 : <span id="brasserie9">—</span></li>
            <li>Brasserie 10 : <span id="brasserie10">—</span></li>
           
            
            <li>Taux d'humidité au début (%) : <span id="humiditeDebut">—</span></li>
            <li>Taux d'humidité à la fin (%) : <span id="humiditeFin">—</span></li>
            <li>Taux de protéines au début (%) : <span id="proteinesDebut">—</span></li>
            <li>Taux de protéines à la fin (%) : <span id="proteinesFin">—</span></li>
            <li>Extrait brut au début (%) : <span id="extraitDebut">—</span></li>
            <li>Extrait brut à la fin (%) : <span id="extraitFin">—</span></li>
            <li>Teneur en Beta-Glucanes au début : <span id="betaGlucanesDebut">—</span></li>
            <li>Teneur en Beta-Glucanes à la fin : <span id="betaGlucanesFin">—</span></li>
            <li>Teneur en impuretés au début : <span id="impuretesDebut">—</span></li>
            <li>Teneur en impuretés à la fin : <span id="impuretesFin">—</span></li>

        </ul>
    </div>
</div>



<!-- ACCORDÉONS Brasserie-->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)" style="background-image:url(&#39;beer-2370783_1280.jpg&#39;);">
        <div class="accordion-title">Brassage</div>
    </div>
    <div class="accordion-content">
        <ul>
            <li>Identification du lot : <span id="identificationLot">—</span></li>
            <li>Nom de la distillerie : <span id="nomDistillerie">—</span></li>
            <li>Code postal : <span id="codePostal">—</span></li>
            <li>Type d'alambic : <span id="typeAlambic">—</span></li>
            <li>Date du brassage : <span id="dateBrassage">—</span></li>
            <li>Date de la distillation : <span id="dateDistillation">—</span></li>
            <li>Volume du wash (fini) : <span id="volumeWash">—</span></li>
            <li>Volume du distillat : <span id="volumeDistillat">—</span></li>
            <li>Vol alcool pur (LAP) : <span id="volumeAlcoolPur">—</span></li>
            
            <li>Type de malt : <span id="typeMalt">—</span></li>
            <li>Quantité de malt (kg) : <span id="quantiteMalt">—</span></li>
            <li>Ratio du malt : <span id="ratioMalt">—</span></li>
            <li>Origine / Fournisseur du malt : <span id="origineMalt">—</span></li>
            <li>N° de lot du malt : <span id="lotMalt">—</span></li>
            
            <li>Souche / type de levure : <span id="typeLevure">—</span></li>
            <li>Origine de la levure : <span id="origineLevure">—</span></li>
            <li>Fournisseur de la levure : <span id="fournisseurLevure">—</span></li>
            
            <li>Correction apportée à l'eau : <span id="correctionEau">—</span></li>
            <li>pH corrigé au départ : <span id="phDepart">—</span></li>
            <li>pH corrigé en fin de brassage : <span id="phFin">—</span></li>
            <li>Dureté : <span id="dureteEau">—</span></li>
            <li>Additifs / Ingrédients spéciaux : <span id="additifsSpeciaux">—</span></li>
            
            <li>Consommation d'eau pour ce brassin : <span id="consoEauBrassin">—</span></li>
            <li>Consommation d'eau pour le nettoyage : <span id="consoEauNettoyage">—</span></li>
            <li>Consommation d'énergie estimée : <span id="consoEnergie">—</span></li>
            
            <li>Valorisation des drêches : <span id="valorisationDreches">—</span></li>
            <li>Comment (drêches) ? : <span id="commentDreches">—</span></li>
            <li>Gestion des déchets / recyclage : <span id="gestionDechets">—</span></li>
            <li>Comment (déchets) ? : <span id="commentDechets">—</span></li>
            
            <li>Mode de conditionnement du produit fini : <span id="modeConditionnement">—</span></li>

        </ul>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-infos">
        <div class="footer-block">
            <img src="Capture_d_écran_2025-11-17_220106-removebg-preview.png" alt="">
            <div class="footer-text">
                <strong>Malterie Occitane</strong><br>
                malterieoccitane.fr<br>
                1273 Avenue des Terres Noires, 81370 St Sulpice la Pointe
            </div>
        </div>
        <div class="footer-block">
            <img src="content.png" alt="">
            <div class="footer-text">
                <strong>The Malt Initiative – Projet Grain Trust :</strong><br>
                Projet Ingénieur Agronome de l’AgroToulouse<br>
                Mail : themaltinitiative@gmail.com
            </div>
        </div>
    </div>
</footer>

<script>
// --- ACCORDIONS ---
function toggleAccordion(header){
    const content = header.nextElementSibling;
    const isOpen = content.style.maxHeight;

    document.querySelectorAll('.accordion-content').forEach(c => {
        c.style.maxHeight = null;
        c.classList.remove("open");
    });

    if(!isOpen){
        content.style.maxHeight = content.scrollHeight + "px";
        content.classList.add("open");
    }
}

// Parser CSV avec en-tête
function parseCSV(csv) {
    const lines = csv.trim().split(/\r?\n/);
    if(lines.length < 2) return [];

    // En-têtes
    const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));

    // Lecture des lignes
    return lines.slice(1).map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
            const char = line[i];

            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                values.push(current.trim().replace(/^"|"$/g, ''));
                current = '';
            } else {
                current += char;
            }
        }
        values.push(current.trim().replace(/^"|"$/g, '')); // Dernière valeur

        const obj = {};
        headers.forEach((h, i) => {
            obj[h] = values[i] || '';
        });
        return obj;
    });
}


// masquer automatiquement les champs vides 
function masquerChampsVides() {
    document.querySelectorAll("li").forEach(li => {
        const span = li.querySelector("span");
        if (!span) return;
        const valeur = span.textContent.trim();
        if (valeur === "" || valeur === "—" || valeur === "-" || valeur.toLowerCase() === "null") {
            li.style.display = "none";
        }
    });
}
    
// Mettre à jour la page avec la ligne sélectionnée
function updatePageWithLine(line){
    if(!line) return;
    // Empreinte carbone
    document.getElementById('dateSoumission').textContent = line["Date de soumission"] || '—';
    document.getElementById('dernierePage').textContent = line["Dernière page"] || '—';
    document.getElementById('langue').textContent = line["Langue de départ"] || '—';
    document.getElementById('teteSerie').textContent = line["Tête de série"] || '—';
    document.getElementById('dateLancement').textContent = line["Date de lancement"] || '—';
    document.getElementById('dateDerniereAction').textContent = line["Date de la dernière action"] || '—';

    // --- Agriculture / Exploitant ---
    document.getElementById('maillonChaine').textContent = line["Quel maillon de la chaîne êtes-vous ?"] || '—';
    document.getElementById('nomExploitation').textContent = line["Nom de l'exploitation agricole :"] || '—';
    document.getElementById('telephone').textContent = line["Téléphone :"] || '—';
    document.getElementById('commune').textContent = line["Commune :"] || '—';
    document.getElementById('codePostal').textContent = line["Code Postal :"] || '—';
    document.getElementById('siret').textContent = line["N°SIRET :"] || '—';
    document.getElementById('dateCertificationBio').textContent = line["Date de validité certification bio"] || '—';
    document.getElementById('numeroParcellePAC').textContent = line["Identifiant de la parcelle (n°PAC) :"] || '—';
    document.getElementById('surfaceParcelle').textContent = line["Surface de la parcelle (ha) :"] || '—';
    document.getElementById('gpsLatitude').textContent = line["Coordonnées GPS de la parcelle (Latitude) :"] || '—';
    document.getElementById('gpsLongitude').textContent = line["Coordonnées GPS de la parcelle (Longitude) :"] || '—';
    document.getElementById('typeCerealeCultivee').textContent = line["Type de céréale cultivée :"] || '—';
    document.getElementById('varieteCereale').textContent = line["Variété de céréale :"] || '—';
    document.getElementById('travailSol').textContent = line["Y a-t-il eu un travail du sol ?"] || '—';
    document.getElementById('desherbageMecanique').textContent = line["Et un désherbage mécanique ?"] || '—';
    document.getElementById('nombrePassages').textContent = line["Si oui combien de passages ?"] || '—';
    document.getElementById('fertilisationOrganique').textContent = line["Y a-t-il une présence de fertilisation organique ?"] || '—';
    document.getElementById('typeFertilisation').textContent = line["Type de fertilisation :"] || '—';
    document.getElementById('quantiteFertilisation').textContent = line["Quantité (t/ha) :"] || '—';
    document.getElementById('utilisationIrrigation').textContent = line["Utilisation de l'irrigation :"] || '—';
    document.getElementById('quantiteIrrigation').textContent = line["Quantité :"] || '—';
    document.getElementById('evenementsParticuliers').textContent = line["Événements particuliers ayant eu lieu :"] || '—';
    document.getElementById('dateRecolte').textContent = line["Date de la récolte :"] || '—';
    document.getElementById('tonnageRecolte').textContent = line["Tonnage récolté :"] || '—';
    document.getElementById('stockageFerme').textContent = line["Stockage à la ferme :"] || '—';
    document.getElementById('dateLivraisonMalterie').textContent = line["Date de livraison à la Malterie Occitane :"] || '—';
    document.getElementById('poidsNetLivreMalterie').textContent = line["Poids net livré (Malterie) :"] || '—';
    document.getElementById('distanceStockageMalterie').textContent = line["Distance du site de stockage à la Malterie (en km) :"] || '—';
    document.getElementById('livraisonCooperative').textContent = line["Livraison à une coopérative :"] || '—';
    document.getElementById('dateLivraisonCoop').textContent = line["Date de livraison à la coopérative :"] || '—';
    document.getElementById('poidsNetLivreCoop').textContent = line["Poids net livré (Coopérative) :"] || '—';
    document.getElementById('humiditeRecolte').textContent = line["Humidité de la récolte (en %) :"] || '—';
    document.getElementById('proteinesRecolte').textContent = line["Taux de protéines à la récolte (en %) :"] || '—';
    document.getElementById('impuretesRecolte').textContent = line["Teneur en impuretés (en %) :"] || '—';

    
    // --- Malterie ---
    document.getElementById('idReponse').textContent = line["ID de la réponse"] || '—';
    document.getElementById('numeroLot').textContent = line["N° du lot de céréales :"] || '—';
    document.getElementById('dateReceptionLot').textContent = line["Date de réception du lot :"] || '—';
    document.getElementById('typeCereale').textContent = line["Type de céréale :"] || '—';
    document.getElementById('variete').textContent = line["Variété :"] || '—';
    document.getElementById('bioConventionnel').textContent = line["Bio ou conventionnel :"] || '—';
    document.getElementById('masseLotT').textContent = line["Masse du lot (en t) :"] || '—';
    document.getElementById('triageCalibrage').textContent = line["Triage, calibrage, nettoyage :"] || '—';
    document.getElementById('dateProduction').textContent = line["Date de production :"] || '—';
    document.getElementById('fournisseur').textContent = line["Nommer le fournisseur :"] || '—';
    document.getElementById('siloOrigine').textContent = line["Silo (ou lieu) d'origine :"] || '—';
    document.getElementById('nom').textContent = line["Nom :"] || '—';
    document.getElementById('distanceMalterie').textContent = line["Distance à la Malterie (en km) :"] || '—';
    document.getElementById('nombreTrempes').textContent = line["Nombre de trempes :"] || '—';
    document.getElementById('tempsTrempage').textContent = line["Temps de trempage :"] || '—';
    document.getElementById('volumeEau').textContent = line["Volume d'eau total utilisé :"] || '—';
    document.getElementById('masseLot').textContent = line["Masse du lot :"] || '—';
    document.getElementById('masseGrainsGermes').textContent = line["Masse de grains germés :"] || '—';
    document.getElementById('hauteurCouche').textContent = line["Hauteur de la couche (en cm) :"] || '—';
    document.getElementById('temperatureLit').textContent = line["Température du lit (en °C) :"] || '—';
    document.getElementById('tempsGermination').textContent = line["Temps de germination (en heures) :"] || '—';
    document.getElementById('tempsTouraillage').textContent = line["Temps du touraillage (en heures) :"] || '—';
    document.getElementById('nombrePaliers').textContent = line["Nombre de paliers :"] || '—';
    document.getElementById('temperatureSechage').textContent = line["Température moyenne de séchage (en °C) :"] || '—';
    document.getElementById('brasserie1').textContent = line["Brasserie 1 :"] || '—';
    document.getElementById('brasserie2').textContent = line["Brasserie 2 :"] || '—';
    document.getElementById('brasserie3').textContent = line["Brasserie 3 :"] || '—';
    document.getElementById('brasserie4').textContent = line["Brasserie 4 :"] || '—';
    document.getElementById('brasserie5').textContent = line["Brasserie 5 :"] || '—';
    document.getElementById('brasserie6').textContent = line["Brasserie 6 :"] || '—';
    document.getElementById('brasserie7').textContent = line["Brasserie 7 :"] || '—';
    document.getElementById('brasserie8').textContent = line["Brasserie 8 :"] || '—';
    document.getElementById('brasserie9').textContent = line["Brasserie 9 :"] || '—';
    document.getElementById('brasserie10').textContent = line["Brasserie 10 :"] || '—';
    document.getElementById('humiditeDebut').textContent = line["Taux d'humidité au début (%) :"] || '—';
    document.getElementById('humiditeFin').textContent = line["Taux d'humidité à la fin (%) :"] || '—';
    document.getElementById('proteinesDebut').textContent = line["Taux de protéines au début (%) :"] || '—';
    document.getElementById('proteinesFin').textContent = line["Taux de protéines à la fin (%) :"] || '—';
    document.getElementById('extraitDebut').textContent = line["Extrait brut au début (%) :"] || '—';
    document.getElementById('extraitFin').textContent = line["Extrait brut à la fin (%) :"] || '—';
    document.getElementById('betaGlucanesDebut').textContent = line["Teneur en Beta-Glucanes au début :"] || '—';
    document.getElementById('betaGlucanesFin').textContent = line["Teneur en Beta-Glucanes à la fin :"] || '—';
    document.getElementById('impuretesDebut').textContent = line["Teneur en impuretés au début :"] || '—';
    document.getElementById('impuretesFin').textContent = line["Teneur en impuretés à la fin :"] || '—';

    
    // --- Brasserie / Distillation ---
    document.getElementById('identificationLot').textContent = line["Identification du lot :"] || '—';
    document.getElementById('nomDistillerie').textContent = line["Nom de la distillerie :"] || '—';
    document.getElementById('typeAlambic').textContent = line["Type d'alambic (post still, colonne, hybride) :"] || '—';
    document.getElementById('dateBrassage').textContent = line["Date du brassage :"] || '—';
    document.getElementById('dateDistillation').textContent = line["Date de la distillation :"] || '—';
    document.getElementById('volumeWash').textContent = line["Volume du wash (fini) :"] || '—';
    document.getElementById('volumeDistillat').textContent = line["Volume du distillat :"] || '—';
    document.getElementById('volumeAlcoolPur').textContent = line["Vol alcool Pur (LAP) :"] || '—';
    document.getElementById('typeMalt').textContent = line["Type de malt :"] || '—';
    document.getElementById('quantiteMalt').textContent = line["Quantité (en kg) :"] || '—';
    document.getElementById('ratioMalt').textContent = line["Ratio (en kg ou % du versement total) :"] || '—';
    document.getElementById('origineMalt').textContent = line["Origine / Fournisseur :"] || '—';
    document.getElementById('lotMalt').textContent = line["N° de lot du malt :"] || '—';
    document.getElementById('typeLevure').textContent = line["Souche / type de levure :"] || '—';
    document.getElementById('origineLevure').textContent = line["Origine :"] || '—';
    document.getElementById('fournisseurLevure').textContent = line["Fournisseur :"] || '—';
    document.getElementById('correctionEau').textContent = line["Correction apportée à l'eau :"] || '—';
    document.getElementById('phDepart').textContent = line["pH corrigé au départ :"] || '—';
    document.getElementById('phFin').textContent = line["pH corrigé en fin de brassage :"] || '—';
    document.getElementById('dureteEau').textContent = line["Dureté :"] || '—';
    document.getElementById('additifsSpeciaux').textContent = line["Additifs / Ingrédients spéciaux :"] || '—';
    document.getElementById('consoEauBrassin').textContent = line["Consommation d'eau pour ce brassin :"] || '—';
    document.getElementById('consoEauNettoyage').textContent = line["Consommation d'eau pour le nettoyage :"] || '—';
    document.getElementById('consoEnergie').textContent = line["Consommation d'énergie estimée :"] || '—';
    document.getElementById('valorisationDreches').textContent = line["Valorisation des drêches :"] || '—';
    document.getElementById('commentDreches').textContent = line["Comment ?"] || '—';
    document.getElementById('gestionDechets').textContent = line["Gestion des déchets/recyclage :"] || '—';
    document.getElementById('commentDechets').textContent = line["Comment ?"] || '—';
    document.getElementById('modeConditionnement').textContent = line["Mode de conditionnement du produit fini :"] || '—';
}

// --- CHARGEMENT DU LOT ---
async function loadLot() {
    const loadBtn = document.getElementById('loadBtn');
    const lotInput = document.getElementById('lotInput').value.trim();
    if (!lotInput) { 
        alert("Veuillez entrer un numéro de lot !"); 
        return; 
    }

    // Vérification majeure
    const isAdult = confirm("Ce site présente des informations liées à l'alcool.\nConfirmez-vous avoir plus de 18 ans ?");
    if (!isAdult) {
        alert("Accès refusé : vous devez être majeur pour continuer.");
        return;
    }

    // Séparer le préfixe et l'ID
    const parts = lotInput.split('-');
    if (parts.length !== 2) {
        alert("Format invalide : utilisez par exemple MO-3");
        return;
    }

    const csvFile = parts[0];       // ex: MO
    const idRecherche = parts[1];   // ex: 1

    // Afficher loader
    const loader = document.getElementById('loader');
    loader.style.display = "flex";
    loader.setAttribute('aria-hidden', 'false');
    loadBtn.disabled = true;
    loadBtn.style.opacity = 0.6;
    loadBtn.style.cursor = 'not-allowed';

    await new Promise(resolve => setTimeout(resolve, 500));

    // URL du CSV
    const csvPath = `https://raw.githubusercontent.com/themaltinitiative-ops/Malt-Initiative/master/data/${csvFile}.csv`;

    try {
        const response = await fetch(csvPath);
        if (!response.ok) throw new Error("Fichier CSV introuvable (404)");

        const csvText = await response.text();
        const data = parseCSV(csvText);

        // Recherche de la ligne correspondant à l'ID
        const line = data.find(d => (d["ID de la réponse"] || '').trim().replace(/^"|"$/g, '') === idRecherche.trim());
        if (!line) throw new Error("ID de la réponse non trouvé dans le CSV");

        updatePageWithLine(line);

        // Masquer les champs vides
        masquerChampsVides();

    } catch (err) {
        alert("Erreur : " + err.message);
    } finally {
        loader.style.display = "none";
        loadBtn.disabled = false;
        loadBtn.style.opacity = '';
        loadBtn.style.cursor = '';
    }
}





document.getElementById('loadBtn').addEventListener('click', loadLot);
</script>

</body>
</html>

