<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Transparence – Informations du lot</title>
<style>
/* --- RESET ET BODY --- */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #F7F3ED;
    color: #0f1724;
    padding: 0;
}

/* Loader */
#loader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    display: none; /* caché par défaut */
}
#loader img {
    width: 150px;
    animation: spin 1.5s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Bannière */
.header-images img { width: 100%; height: auto; display: block; }

/* --- TITRE --- */
h1 {
    text-align: center;
    margin: 20px 0;
}

/* --- CHAMP DE LOT --- */
#lotInput, button {
    font-size: 16px;
}

/* --- ACCORDIONS --- */
.accordion {
    background: #f0e6d2;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    margin: 20px auto;
    max-width: 900px;
}

.accordion-header {
    background-size: cover;
    background-position: center;
    height: 120px;
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding-left: 20px;
}

.accordion-header::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.25);
}

.accordion-title {
    position: relative;
    font-size: 22px;
    color: white;
    font-weight: bold;
    z-index: 5;
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    background: #fff;
    padding: 0 20px;
}

.accordion-content.open {
    padding: 20px;
}

/* --- LISTES --- */
ul {
    margin: 10px 0 20px 20px;
    padding: 0;
    list-style-type: disc;
}

ul li {
    margin-bottom: 6px;
}

/* simple table style for lists */
.table-list { width: 100%; border-collapse: collapse; margin-top: 12px; }
.table-list th, .table-list td { border: 1px solid #e6e6e6; padding: 8px; text-align: left; }
.table-list th { background: #fafafa; }

/* --- FOOTER --- */
footer {
    background: #e2e2e2;
    padding: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

footer .footer-block {
    display: flex;
    align-items: center;
    margin: 10px;
}

footer .footer-block img {
    max-width: 80px;
    margin-right: 15px;
}

footer .footer-text {
    font-size: 14px;
    line-height: 1.4;
}

/* small responsive */
@media (max-width:600px){
    .accordion-header { height: 90px; padding-left: 12px; }
    .accordion-title { font-size: 18px; }
}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader" aria-hidden="true" style="display:none;">
    <img src="Dessin_chope_de_biere_480x480-removebg-preview.png" alt="Chargement...">
</div>

<!-- BANNIERE -->
<div class="header-images">
    <img src="bannire-fine.png" alt="Bannière The Malt Initiative">
</div>

<h1>Informations du Lot</h1>

<!-- CHAMP DE SAISIE DU LOT -->
<div style="text-align:center; margin:20px;">
    <label for="lotInput"><strong>Entrer le numéro de lot :</strong></label>
    <input type="text" id="lotInput" placeholder="Ex : 202603" style="padding:6px 10px; border-radius:6px; border:1px solid #ccc;">
    <button id="loadBtn" style="padding: 6px 12px; border-radius: 6px; border: none; background: rgb(21, 128, 61); color: white;">Charger le lot</button>
</div>


<!-- ACCORDÉONS -->
<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">Accordéon 1 : Informations générales</div>
    <div class="accordion-content" id="accordion1"></div>
</div>

<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">Accordéon 2 : Suivi des actions</div>
    <div class="accordion-content" id="accordion2"></div>
</div>

<div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">Accordéon 3 : Identification exploitant</div>
    <div class="accordion-content" id="accordion3"></div>
</div>

<script>
// --- Accordion toggle ---
function toggleAccordion(header){
    const content = header.nextElementSibling;
    document.querySelectorAll('.accordion-content').forEach(c => {
        if(c !== content) c.style.maxHeight = null;
        c.classList.remove("open");
    });
    if(!content.classList.contains("open")){
        content.style.maxHeight = content.scrollHeight + "px";
        content.classList.add("open");
    }
}

// --- Parse CSV avec en-têtes ---
function parseCSV(csvText){
    const lines = csvText.trim().split(/\r?\n/);
    const headers = lines[0].split('\t');
    const rows = lines.slice(1).map(line => {
        const values = line.split('\t');
        const obj = {};
        headers.forEach((h,i)=>obj[h.trim()] = values[i]?values[i].trim():'');
        return obj;
    });
    return rows;
}


<!-- FOOTER -->
<footer>
    <div class="footer-infos">
        <div class="footer-block">
            <img src="Capture_d_écran_2025-11-17_220106-removebg-preview.png" alt="">
            <div class="footer-text">
                <strong>Malterie Occitane</strong><br>
                malterieoccitane.fr<br>
                1273 Avenue des Terres Noires, 81370 St Sulpice la Pointe
            </div>
        </div>

        <div class="footer-block">
            <img src="content.png" alt="">
            <div class="footer-text">
                <strong>The Malt Initiative – Projet Grain Trust :</strong><br>
                Projet Ingénieur Agronome de l’AgroToulouse<br>
                Mail : themaltinitiative@gmail.com
            </div>
        </div>
    </div>
</footer>

<script>
// --- Accordion toggle ---
function toggleAccordion(header){
    const content = header.nextElementSibling;
    document.querySelectorAll('.accordion-content').forEach(c => {
        if(c !== content) c.style.maxHeight = null;
        c.classList.remove("open");
    });
    if(!content.classList.contains("open")){
        content.style.maxHeight = content.scrollHeight + "px";
        content.classList.add("open");
    }
}

// --- Charger et afficher CSV large ---
async function loadLot() {
    const loadBtn = document.getElementById('loadBtn');
    const lotId = document.getElementById('lotInput').value.trim();
    if (!lotId) {
        alert("Veuillez entrer un numéro de lot !");
        return;
    }

    if(!confirm("Ce site présente des informations liées à l'alcool.\nConfirmez-vous avoir plus de 18 ans ?")) return;

    const loader = document.getElementById('loader');
    loader.style.display = "flex";
    loadBtn.disabled = true;

    const csvPath = `https://raw.githubusercontent.com/themaltinitiative-ops/Malt-Initiative/master/data/${lotId}.csv`;

    try {
        const response = await fetch(csvPath);
        if (!response.ok) throw new Error("Fichier CSV introuvable");

        const csvText = await response.text();
        const lines = csvText.trim().split(/\r?\n/).filter(l=>l.length>0);
        if(lines.length<2) throw new Error("CSV vide");

        const headers = lines[0].split('\t').map(h=>h.trim());
        const data = lines.slice(1).map(line => line.split('\t'));

        const acc1 = document.getElementById('accordion1');
        const acc2 = document.getElementById('accordion2');
        const acc3 = document.getElementById('accordion3');

        // Nettoyage
        acc1.innerHTML = ''; acc2.innerHTML = ''; acc3.innerHTML = '';

        // Découpage dynamique en 3 parties
        const total = headers.length;
        const part1End = Math.floor(total/3)-1;
        const part2End = Math.floor(total*2/3)-1;

        data.forEach(row => {
            appendColumns(acc1, headers, row, 0, part1End);
            appendColumns(acc2, headers, row, part1End+1, part2End);
            appendColumns(acc3, headers, row, part2End+1, total-1);
        });

        // Ouvre automatiquement le 1er accordéon
        autoOpenFirstAccordion();

    } catch(err){
        alert("Erreur : " + err.message);
    } finally{
        loader.style.display = "none";
        loadBtn.disabled = false;
    }
}

// --- Ajout des colonnes dans un accordéon ---
function appendColumns(acc, headers, row, start, end){
    const ul = document.createElement('ul');
    for(let i=start; i<=end; i++){
        if(headers[i] && row[i]!==undefined && row[i].trim()!==''){
            const li = document.createElement('li');
            li.innerHTML = `<strong>${headers[i]} :</strong> ${row[i]}`;
            ul.appendChild(li);
        }
    }
    acc.appendChild(document.createElement('hr'));
    acc.appendChild(ul);
}

// --- Ouvre automatiquement le premier accordéon ---
function autoOpenFirstAccordion(){
    const first = document.querySelector(".accordion .accordion-header");
    if(first) toggleAccordion(first);
}

document.getElementById('loadBtn').addEventListener('click', loadLot);
</script>


</body>
</html>
